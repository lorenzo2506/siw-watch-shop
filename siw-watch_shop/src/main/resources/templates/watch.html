<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{fragments/layout :: base(~{::title}, ~{::main})}">
<head>
    <title th:text="${watch.name} + ' - TimeCraft'">Orologio - TimeCraft</title>
</head>
<body>
    <main>
        <div class="watch-detail-container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a th:href="@{/}">Home</a>
                <span>›</span>
                <a th:href="@{/watches}">Orologi</a>
                <span>›</span>
                <span th:text="${watch.name}">Nome Orologio</span>
            </nav>

            <!-- Grid principale -->
            <div class="watch-detail-grid">
                <!-- Immagine -->
                <div class="watch-detail-image">
                    <img th:if="${watch.imagePath}" 
                         th:src="@{/images/{filename}(filename=${watch.imagePath})}" 
                         th:alt="${watch.name}"
                         class="watch-detail-img">
                    <div th:unless="${watch.imagePath}" class="watch-detail-placeholder">
                        <span>⌚</span>
                    </div>
                </div>

                <!-- Informazioni -->
                <div class="watch-detail-info">
                    <h1 class="watch-detail-name" th:text="${watch.name} + ' - ' + ${watch.brand}">Nome Orologio</h1>
                    
                    <!-- Rating -->
                    <div class="watch-detail-rating" th:if="${watch.averageRating}">
                        <div class="stars">
                            <span class="star filled" th:each="i : ${#numbers.sequence(1, T(java.lang.Math).floor(watch.averageRating))}">★</span>
                            <span class="star half" th:if="${watch.averageRating % 1 >= 0.5}">★</span>
                            <span class="star empty" th:each="i : ${#numbers.sequence(1, 5 - T(java.lang.Math).ceil(watch.averageRating))}">★</span>
                        </div>
                        <span class="rating-text">
                            <strong th:text="${#numbers.formatDecimal(watch.averageRating, 1, 1)}">4.5</strong>
                            (<span th:text="${watch.ratingCount}">12</span> recensioni)
                        </span>
                    </div>
                    <div class="watch-detail-rating no-rating" th:unless="${watch.averageRating}">
                        <span class="no-rating-text">Nessuna recensione ancora</span>
                    </div>

                    <!-- Prezzo -->
                    <div class="watch-detail-price">
                        €<span th:text="${#numbers.formatDecimal(watch.price, 0, 2)} + ' $'">999.00</span>
                    </div>

                    <!-- Anno -->
                    <div class="watch-detail-year">
                        Anno di produzione: <strong th:text="${watch.year}">2024</strong>
                    </div>

                    <!-- Descrizione -->
                    <div class="watch-detail-description">
					    <p th:text="${watch.description ?: 'Nessuna descrizione'}"></p>
					</div>
                    

                    <!-- Azioni per utenti autenticati -->
                    <div class="watch-detail-actions" th:if="${isUser}">
                        <form th:action="@{/currentOrder/add/{id}(id=${watch.id})}" method="post">
                            <input type="hidden" name="watchId" th:value="${watch.id}">
                            <button type="submit" 
                                    class="btn-add-cart" 
                                    th:disabled="${!watch.availability}">
                                <span th:if="${watch.availability}">Aggiungi al Carrello</span>
                                <span th:unless="${watch.availability}">Non Disponibile</span>
                            </button>
                        </form>   
                    </div>

						<div th:if="${isAdmin}" class="watch-detail-actions">
    
						    <form th:if="${watch.availability}" th:action="@{/admin/watch/{id}/deactivate(id=${watch.id})}" method="post">
						        <button type="submit" class="btn-add-cart" style="background: #ffa500">
						            Disattiva Watch
						        </button>
						    </form>
						    
						    <!-- Riattiva (solo se non attivo) -->
						    <form th:if="${!watch.availability}" th:action="@{/admin/watch/{id}/reactivate(id=${watch.id})}" method="post">
						        <button type="submit" class="btn-add-cart">
						            Riattiva Watch
						        </button>
						    </form>
						    
						    <!-- Elimina (sempre disponibile) -->
						    <form th:action="@{/admin/watch/{id}/delete(id=${watch.id})}" method="post" >
						        <button type="submit" class="btn-add-cart" style="background: #ef4444;">
						            Elimina Watch
						        </button>
						    </form>
						</div>
                    	
                    	
                    <!-- Prompt per login se non autenticato -->
                    <div class="login-prompt" th:if="${!isAuthenticated}">
                        <p>Accedi per aggiungere questo orologio al tuo carrello</p>
                        <div class="auth-actions">
                            <a th:href="@{/login}" class="btn-login">Accedi</a>
                            <a th:href="@{/register}" class="btn-register">Registrati</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sezione caratteristiche tecniche -->
            <div class="watch-specs" th:if="${watch.description}">
                <h3>Caratteristiche</h3>
                <div class="specs-grid">
                    <div class="spec-item">
                        <span class="spec-label">Brand:</span>
                        <span class="spec-value" th:text="${watch.brand}">Rolex</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Anno:</span>
                        <span class="spec-value" th:text="${watch.year}">2024</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Disponibilità:</span>
                        <span class="spec-value" th:text="${watch.availability ? 'Disponibile' : 'Non disponibile'}">Disponibile</span>
                    </div>
                </div>
            </div>

            <!-- Reviews link section -->
            <div class="reviews-link-section">
                <div class="reviews-link-card" th:if="${watch.ratingCount > 0}">
                    <div class="reviews-summary">
                        <h3>Recensioni Clienti</h3>
                        <div class="rating-summary">
                            <div class="stars-large">
                                <span class="star filled" th:each="i : ${#numbers.sequence(1, T(java.lang.Math).floor(watch.averageRating))}">★</span>
                                <span class="star half" th:if="${watch.averageRating % 1 >= 0.5}">★</span>
                                <span class="star empty" th:each="i : ${#numbers.sequence(1, 5 - T(java.lang.Math).ceil(watch.averageRating))}">★</span>
                            </div>
                            <span class="rating-average" th:text="${#numbers.formatDecimal(watch.averageRating, 1, 1)}">4.5</span>
                            <span class="rating-count">su 5 stelle</span>
                        </div>
                        <p class="total-reviews" th:text="${watch.ratingCount + ' recensioni totali'}">12 recensioni totali</p>
                    </div>
                    <div class="reviews-cta">
                        <a th:href="@{/watch/{id}/reviews(id=${watch.id})}" class="btn-view-reviews">
                            <span class="reviews-icon"></span>
                            Leggi Recensioni
                        </a>
                    </div>
                </div>
                
                
                <div th:if="${#lists.isEmpty(reviews)}" class="reviews-cta">
                        <a th:href="@{/watch/{id}/reviews(id=${watch.id})}" class="btn-view-reviews">
                            <span class="reviews-icon"></span>
                            Leggi Recensioni
                        </a>
                    </div>


                

            </div>

            
        </div>
    </main>
</body>
</html>