<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org" 
      th:replace="~{fragments/layout :: base(~{::title}, ~{::main})}">
<head>
    <title th:text="${watch.name} + ' - TimeCraft'">Orologio - TimeCraft</title>
</head>
<body>
    <main>
        <div class="watch-detail-container">
            <!-- Breadcrumb -->
            <nav class="breadcrumb">
                <a th:href="@{/}">Home</a>
                <span>‚Ä∫</span>
                <a th:href="@{/watches}">Orologi</a>
                <span>‚Ä∫</span>
                <span th:text="${watch.name}">Nome Orologio</span>
            </nav>

            <!-- Grid principale -->
            <div class="watch-detail-grid">
                <!-- Immagine -->
                <div class="watch-detail-image">
                    <img th:if="${watch.imagePath}" 
                         th:src="@{/images/{filename}(filename=${watch.imagePath})}" 
                         th:alt="${watch.name}"
                         class="watch-detail-img">
                    <div th:unless="${watch.imagePath}" class="watch-detail-placeholder">
                        <span>‚åö</span>
                    </div>
                </div>

                <!-- Informazioni -->
                <div class="watch-detail-info">
                    <div class="watch-detail-brand" th:text="${watch.brand}">Brand</div>
                    <h1 class="watch-detail-name" th:text="${watch.name}">Nome Orologio</h1>
                    
                    <!-- Rating -->
                    <div class="watch-detail-rating" th:if="${watch.averageRating}">
                        <div class="stars">
                            <span class="star filled" th:each="i : ${#numbers.sequence(1, T(java.lang.Math).floor(watch.averageRating))}">‚òÖ</span>
                            <span class="star half" th:if="${watch.averageRating % 1 >= 0.5}">‚òÖ</span>
                            <span class="star empty" th:each="i : ${#numbers.sequence(1, 5 - T(java.lang.Math).ceil(watch.averageRating))}">‚òÖ</span>
                        </div>
                        <span class="rating-text">
                            <strong th:text="${#numbers.formatDecimal(watch.averageRating, 1, 1)}">4.5</strong>
                            (<span th:text="${watch.ratingCount}">12</span> recensioni)
                        </span>
                    </div>
                    <div class="watch-detail-rating no-rating" th:unless="${watch.averageRating}">
                        <span class="no-rating-text">Nessuna recensione ancora</span>
                    </div>

                    <!-- Prezzo -->
                    <div class="watch-detail-price">
                        ‚Ç¨<span th:text="${#numbers.formatDecimal(watch.price, 0, 2)}">999.00</span>
                    </div>

                    <!-- Anno -->
                    <div class="watch-detail-year">
                        Anno di produzione: <strong th:text="${watch.year}">2024</strong>
                    </div>

                    <!-- Descrizione -->
                    <div class="watch-detail-description" th:if="${watch.description}">
                        <p th:text="${watch.description}">Descrizione dell'orologio...</p>
                    </div>

                    <!-- Azioni per utenti autenticati -->
                    <div class="watch-detail-actions" th:if="${isUser}">
                        <form th:action="@{/currentOrder/add}" method="post">
                            <input type="hidden" name="watchId" th:value="${watch.id}">
                            <button type="submit" 
                                    class="btn-add-cart" 
                                    th:disabled="${!watch.availability}">
                                <span th:if="${watch.availability}">Aggiungi al Carrello</span>
                                <span th:unless="${watch.availability}">Non Disponibile</span>
                            </button>
                        </form>
                        <a th:href="@{/currentOrder}" class="btn-view-cart">
                            Vedi Carrello
                        </a>
                    </div>

                    <!-- Prompt per login se non autenticato -->
                    <div class="login-prompt" th:unless="${isUser}">
                        <p>Accedi per aggiungere questo orologio al tuo carrello</p>
                        <div class="auth-actions">
                            <a th:href="@{/login}" class="btn-login">Accedi</a>
                            <a th:href="@{/register}" class="btn-register">Registrati</a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sezione caratteristiche tecniche -->
            <div class="watch-specs" th:if="${watch.description}">
                <h3>Caratteristiche</h3>
                <div class="specs-grid">
                    <div class="spec-item">
                        <span class="spec-label">Brand:</span>
                        <span class="spec-value" th:text="${watch.brand}">Rolex</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Anno:</span>
                        <span class="spec-value" th:text="${watch.year}">2024</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">Disponibilit√†:</span>
                        <span class="spec-value" th:text="${watch.availability ? 'Disponibile' : 'Non disponibile'}">Disponibile</span>
                    </div>
                </div>
            </div>

            <!-- Reviews link section -->
            <div class="reviews-link-section">
                <div class="reviews-link-card" th:if="${watch.ratingCount > 0}">
                    <div class="reviews-summary">
                        <h3>Recensioni Clienti</h3>
                        <div class="rating-summary">
                            <div class="stars-large">
                                <span class="star filled" th:each="i : ${#numbers.sequence(1, T(java.lang.Math).floor(watch.averageRating))}">‚òÖ</span>
                                <span class="star half" th:if="${watch.averageRating % 1 >= 0.5}">‚òÖ</span>
                                <span class="star empty" th:each="i : ${#numbers.sequence(1, 5 - T(java.lang.Math).ceil(watch.averageRating))}">‚òÖ</span>
                            </div>
                            <span class="rating-average" th:text="${#numbers.formatDecimal(watch.averageRating, 1, 1)}">4.5</span>
                            <span class="rating-count">su 5 stelle</span>
                        </div>
                        <p class="total-reviews" th:text="${watch.ratingCount + ' recensioni totali'}">12 recensioni totali</p>
                    </div>
                    <div class="reviews-cta">
                        <a th:href="@{/watch/{id}/reviews(id=${watch.id})}" class="btn-view-reviews">
                            <span class="reviews-icon">üí¨</span>
                            Leggi Recensioni
                        </a>
                    </div>
                </div>

                <!-- Quando non ci sono recensioni -->
                <div class="no-reviews-link" th:unless="${watch.ratingCount > 0}">
                    <div class="no-reviews-summary">
                        <h3>Recensioni</h3>
                        <p>Questo orologio non ha ancora recensioni.</p>
                        <p th:if="${isUser}">Sii il primo a lasciare una recensione dopo l'acquisto!</p>
                    </div>
                    <div class="first-review-cta" th:if="${isUser}">
                        <span class="review-icon">‚≠ê</span>
                        <span>Acquista e lascia la prima recensione</span>
                    </div>
                </div>
            </div>

            <!-- Orologi correlati -->
            <div class="related-watches" th:if="${watch.brand}">
                <h3>Altri Orologi <span th:text="${watch.brand}">Brand</span></h3>
                <div class="related-grid">
                    <p>Scopri altri orologi dello stesso brand nella nostra collezione esclusiva.</p>
                    <a th:href="@{/watches}" class="btn-view-all">Esplora Collezione</a>
                </div>
            </div>
        </div>
    </main>
</body>
</html>